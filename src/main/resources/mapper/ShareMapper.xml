<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.scau.pyx.ssp.mapper.ShareMapper">
    <insert id="insertShare" parameterType="edu.scau.pyx.ssp.entity.Share" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO T_SHARE ( CONTENT,STATE,USER_ID )
        VALUES (#{content},#{state},#{userId});
    </insert>
    <select id="getShare" resultType="edu.scau.pyx.ssp.entity.ShareListInfo">
        SELECT U.`NAME` AS username, I.AVATAR_URL AS userAvatarUrl, S.TIME AS time, S.CONTENT AS content
        FROM T_SHARE AS S,T_USER AS U,T_USER_INFO AS I
        WHERE S.USER_ID=U.ID AND U.ID=I.USER_ID AND S.ID=#{shareId};
    </select>
    <select id="getPublicShareList" resultType="edu.scau.pyx.ssp.entity.ShareListInfo">
        SELECT S.ID AS id, U.`NAME` AS username, I.AVATAR_URL AS userAvatarUrl, S.TIME AS time, S.CONTENT AS content
        FROM T_SHARE AS S,T_USER AS U,T_USER_INFO AS I
        WHERE S.USER_ID=U.ID AND U.ID=I.USER_ID AND S.STATE='public'
        LIMIT #{begin},#{length};
    </select>
    <select id="getSharePictureList" resultType="edu.scau.pyx.ssp.entity.Picture">
        SELECT ID AS id, URL AS url, SHARE_ID AS shareId
        FROM T_PICTURE
        WHERE SHARE_ID = #{shareId};
    </select>
    <select id="getMyShareList" resultType="edu.scau.pyx.ssp.entity.ShareListInfo">
        SELECT S.ID AS id, U.`NAME` AS username, I.AVATAR_URL AS userAvatarUrl, S.TIME AS time, S.CONTENT AS content
        FROM T_SHARE AS S,T_USER AS U,T_USER_INFO AS I
        WHERE S.USER_ID=U.ID AND U.ID=I.USER_ID AND S.USER_ID=#{userId}
        LIMIT #{begin},#{length};
    </select>
    <update id="updateShareState">
        UPDATE T_SHARE
        SET `STATE` = #{state}
        WHERE ID = #{shareId};
    </update>
    <select id="searchShare" resultType="edu.scau.pyx.ssp.entity.ShareListInfo">
        SELECT
            S.ID AS id,
            U.`NAME` AS username,
            I.AVATAR_URL AS userAvatarUrl,
            S.TIME AS time,
		S.CONTENT AS content
        FROM T_SHARE AS S,T_USER AS U,T_USER_INFO AS I,
        WHERE CONTENT LIKE #{content} AND S.USER_ID=U.ID AND U.ID=I.USER_ID;
    </select>
    <update id="updateContent">
        UPDATE T_SHARE
        SET CONTENT = #{content}
        WHERE ID = #{id}
    </update>
</mapper>