<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.scau.pyx.ssp.mapper.ReplyMapper">
    <insert id="insertReply">
        INSERT INTO T_REPLY( CONTENT,SEND_USER_ID,ACCEPT_USER_ID,COMMENT_ID )
        VALUES ( #{content},#{sendUserId},#{acceptUserId},#{commentId} );
    </insert>
    <select id="getReply" resultType="edu.scau.pyx.ssp.entity.ReplyListInfo">
        SELECT R.ID AS id,
               U1.ID AS sendUserId,
               U1.`NAME` AS sendUserName,
               I1.AVATAR_URL AS sendUserAvatarUrl,
               U2.ID AS acceptUserId,
               U2.`NAME` AS acceptUserName,
               I2.AVATAR_URL AS acceptUserAvatarUrl,
               R.CONTENT AS content,
               R.TIME AS time
        FROM T_USER AS U1,T_REPLY AS R,T_USER AS U2,T_USER_INFO AS I1,T_USER_INFO AS I2
        WHERE U1.ID=R.SEND_USER_ID AND R.ACCEPT_USER_ID=U2.ID AND R.COMMENT_ID=#{commentId} AND U1.ID = I1.USER_ID AND U2.ID = I2.USER_ID
        ORDER BY R.TIME DESC
        LIMIT #{begin},#{length};

        SELECT C.ID AS id, U.ID AS userId, U.`NAME` AS username, I.AVATAR_URL AS avatarUrl, C.CONTENT AS content, C.TIME AS time
        FROM T_COMMENT AS C,T_USER AS U,T_USER_INFO AS I
        WHERE C.USER_ID=U.ID AND U.ID = I.USER_ID AND C.SHARE_ID = #{shareId}
        ORDER BY C.TIME DESC
            LIMIT #{begin},#{length};
    </select>
    <select id="getReplyNum" resultType="long">
        SELECT COUNT(*)
        FROM T_USER AS U1,T_REPLY AS R,T_USER AS U2
        WHERE U1.ID=R.SEND_USER_ID AND R.ACCEPT_USER_ID=U2.ID AND R.COMMENT_ID=#{commentId};
    </select>
</mapper>